parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"c+uN":[function(require,module,exports) {
"use strict";var r=this&&this.__generator||function(r,e){var t,n,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=e.call(r,u)}catch(l){a=[6,l],n=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},e=this&&this.__read||function(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var n,o,a=t.call(r),u=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)u.push(n.value)}catch(l){o={error:l}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(o)throw o.error}}return u},t=this&&this.__spread||function(){for(var r=[],t=0;t<arguments.length;t++)r=r.concat(e(arguments[t]));return r};Object.defineProperty(exports,"__esModule",{value:!0});var n,o,a,u=Math.floor,l=Math.pow,i=Math.random;function c(e){var n,o;return r(this,function(r){switch(r.label){case 0:n=0,o=s(t(new Array(e).keys())),r.label=1;case 1:return n<o.length?[4,o[n++]]:[3,3];case 2:return r.sent(),[3,1];case 3:return[2]}})}function s(r){for(var t,n=r.length-1;0!=n;--n){var o=u(i()*(n+1));t=e([r[o],r[n]],2),r[n]=t[0],r[o]=t[1]}return r}function f(r){for(var e="",t=o.length,n=0;n!=a;++n)e+="-"+o[r%t],r=u(r/t);return e.substr(1)}function h(r,e){a=e;var t=l((o=r).length,e);n=c(t)}function p(){var r=n.next();if(r.done)throw new RangeError("All IDs are used");return f(r.value)}function b(r){return f(r.substr(0,a).split("").map(function(r){return r.charCodeAt(0)%o.length}).reduce(function(r,e){return r*o.length+e}))}exports.initIdGenerator=h,exports.next_id=p,exports.beautify=b;
},{}],"eFtq":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function s(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),e=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var s,i,n=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return o},r=this&&this.__spread||function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(e(arguments[r]));return t};Object.defineProperty(exports,"__esModule",{value:!0});var s=require("events"),i=require("../lib/id-generator"),n=function(e){function s(){var t=e.call(this)||this;return t.id=i.next_id(),t.sockets=[],t._state=o.LOBBY,t}return t(s,e),Object.defineProperty(s.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"members",{get:function(){var t=this;return this.sockets.map(function(e,r){return t.socket_info(r)})},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"schemes",{get:function(){return{rules:{},physics:{}}},enumerable:!0,configurable:!0}),s.prototype.is_full=function(){return this.sockets.length==a},s.prototype.is_ready=function(){return this.sockets.every(function(t){return t.ready})},s.prototype.join=function(t){if(this.is_full())return!1;t.join(this.id);var e=this.sockets.push(t);switch(this.state){case o.LOBBY:this.cast.apply(this,r(["lobby:join"],this.socket_info(e-1))),this.cast_enabled(),this.is_full()&&this.emit("full");break;case o.ROOM:}return!0},s.prototype.leave=function(t){var e=this.sockets.indexOf(t);if(-1==e)return!1;switch(t.leave(this.id),this.sockets.splice(e,1),this.cast("left",t.public_id),this.state){case o.LOBBY:this.cast_enabled(),this.emit("free");break;case o.ROOM:}return!0},s.prototype.cast_ready=function(t){return!!this.sockets.includes(t)&&(this.cast("lobby:ready",t.public_id,t.ready),this.cast_enabled(),!0)},s.prototype.load_game=function(){return this.state==o.LOBBY&&(this.sockets.forEach(function(t){t.ready=!1}),this._state=o.LOADING,this.emit("full"),this.cast("room:start",this.id),!0)},s.prototype.start_game=function(){return!(this.state!=o.LOADING||!this.is_ready())&&(this._state=o.ROOM,this.cast("game:start"),!0)},s.prototype.cast=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];(e=s.io.to(this.id)).emit.apply(e,r([t],i))},s.prototype.cast_enabled=function(){0!=this.sockets.length&&this.sockets[0].emit("lobby:start-enabled",this.is_ready())},s.prototype.socket_info=function(t){return[this.sockets[t].public_id,this.sockets[t].ready,0==t]},s}(s.EventEmitter);exports.Room=n;var o,a=4;!function(t){t[t.DUMMY=0]="DUMMY",t[t.LOBBY=1]="LOBBY",t[t.LOADING=2]="LOADING",t[t.ROOM=3]="ROOM"}(o=exports.State||(exports.State={})),exports.dummy={state:o.DUMMY,members:[],schemes:{rules:{},physics:{}},is_full:function(){return!0},is_ready:function(){return!1},join:function(t){return!1},leave:function(t){return!1},cast_ready:function(){return!1},load_game:function(){return!1},start_game:function(){return!1}};
},{"../lib/id-generator":"c+uN"}],"4GdQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./room-class"),t=function(){function t(){this.rooms=new Map,this.lobbies=new Set}return t.prototype.get_lobby_id=function(){return 0==this.lobbies.size&&this.add(new e.Room),this.lobbies.values().next().value},t.prototype.get=function(t){return this.rooms.get(t)||e.dummy},t.prototype.add=function(e){var t=this;this.rooms.set(e.id,e),e.on("free",function(){return t.lobbies.add(e.id)}).on("full",function(){return t.lobbies.delete(e.id)}),this.lobbies.add(e.id)},t}();exports.default=new t;
},{"./room-class":"eFtq"}],"yiVK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dummy={ready:!1,room_id:"ERROR: no room"};
},{}],"squD":[function(require,module,exports) {
"use strict";var t=this&&this.__assign||function(){return(t=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./socket-state"),o=function(){function o(){this.pool=new Map}return o.prototype.init=function(t){this.pool.set(t,e.dummy)},o.prototype.get=function(t){return this.pool.get(t)||e.dummy},o.prototype.set=function(e,o){var r=this.pool.get(e);this.pool.set(e,t({},r,o))},o.prototype.inherit=function(t,e){var o=this.pool.get(t);return!!o&&(this.pool.set(e,o),this.pool.delete(t),!0)},o}();exports.StatePool=o,exports.default=new o;
},{"./socket-state":"yiVK"}],"3uE1":[function(require,module,exports) {
module.exports={crates:["heal","util","weapon"],dropChance:.5,gameTime:18e5,retreatTime:5e3,turnTime:3e4,wormCount:4};
},{}],"ZI85":[function(require,module,exports) {
module.exports={};
},{}],"xaTX":[function(require,module,exports) {
module.exports=["jjj","oof","heh","gg","kok","jej","wuw","wp","saas","sos","ooo","ded","liben","raigen","ponel","sasi","flask","dudon","baton","kuku","psina","smertb","borgar"];
},{}],"Ie+l":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var s=e(require("./schemes/game/basic.json"));exports.game={basic:s.default};var i=e(require("./schemes/physics/basic.json"));exports.physics={basic:i.default};var r=e(require("./id-digits.json"));exports.digits=r.default;
},{"./schemes/game/basic.json":"3uE1","./schemes/physics/basic.json":"ZI85","./id-digits.json":"xaTX"}],"UR5i":[function(require,module,exports) {
"use strict";var t=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,i,n=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(o=n.next()).done;)u.push(o.value)}catch(a){i={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return u},e=this&&this.__spread||function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(t(arguments[r]));return e},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var o=r(require("./state-pool")),i=require("./socket-state"),n=require("../lib/id-generator"),u=function(){function t(t){this.id=t.id,this.public_id=n.beautify(this.id),this.socket=t}return Object.defineProperty(t.prototype,"ready",{get:function(){return o.default.get(this.id).ready},set:function(t){o.default.set(this.id,{ready:t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"room_id",{get:function(){return o.default.get(this.id).room_id},enumerable:!0,configurable:!0}),t.prototype.emit=function(t){for(var r,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];(r=this.socket).emit.apply(r,e([t],o))},t.prototype.on=function(t,e){return this.socket.on(t,e),this},t.prototype.join=function(t){this.socket.join(t),o.default.set(this.id,{ready:!1,room_id:t})},t.prototype.leave=function(t){this.socket.leave(t),o.default.set(this.id,{ready:!1,room_id:i.dummy.room_id})},t}();exports.Socket=u;
},{"./state-pool":"squD","./socket-state":"yiVK","../lib/id-generator":"c+uN"}],"W/tX":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("./room-pool")),o=e(require("./state-pool")),n=require("../data/export"),a=require("../lib/id-generator"),i=require("./room-class"),r=require("./socket-class");function u(e){return i.Room.io=e,function(e){console.log("+ socket"),o.default.init(e.id);var t=new r.Socket(e);l(e,t),f(e),d(e,t),c(e,t),s(e,t)}}function l(e,o){e.on("disconnect",function(){console.log("- socket"),t.default.get(o.room_id).leave(o)})}function f(e){e.on("state:inherit",function(t,n){n(o.default.inherit(t,e.id))}).on("state:get",function(t){t(o.default.get(e.id))})}function d(e,o){e.on("lobby:get",function(e){e(t.default.get_lobby_id())}).on("lobby:getme",function(t){t(a.beautify(e.id))}).on("lobby:check",function(e,o){var n=t.default.get(e);o(n.state==i.State.LOBBY&&!n.is_full())}).on("lobby:join",function(e,n){var a=t.default.get(e);n(a.state==i.State.LOBBY&&a.join(o))}).on("lobby:members",function(e,o){o(t.default.get(e).members)}).on("lobby:ready",function(e){o.ready=e;var n=t.default.get(o.room_id);n.state==i.State.LOBBY&&n.cast_ready(o)}).on("lobby:start",function(e){var n=t.default.get(o.room_id);e(n.is_ready()&&n.load_game())}).on("lobby:left",function(){var e=t.default.get(o.room_id);e.state==i.State.LOBBY&&e.leave(o)})}function c(e,o){e.on("room:reconnect",function(e){var n=t.default.get(o.room_id);e(n.state==i.State.ROOM&&n.join(o))}).on("room:checkme",function(e,n){n(e==o.room_id&&t.default.get(e).state==i.State.LOADING)}).on("room:left",function(){var e=t.default.get(o.room_id);e.state==i.State.ROOM&&e.leave(o)})}function s(e,o){e.on("game:ready",function(e){o.ready=!0,e(t.default.get(o.room_id).start_game())}).on("game:scheme",function(e){var n=t.default.get(o.room_id).schemes;e(n.rules,n.physics)})}a.initIdGenerator(n.digits,3),exports.default=u;
},{"./room-pool":"4GdQ","./state-pool":"squD","../data/export":"Ie+l","../lib/id-generator":"c+uN","./room-class":"eFtq","./socket-class":"UR5i"}],"XAkt":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("express")),r=e(require("http")),n=e(require("os")),i=e(require("path")),u=e(require("socket.io")),o=e(require("./socket/main")),s=process.env.DEV_SERVER?"dist":"build",a=i.default.join(__dirname,"../../client/"+s+"/index.html"),l=t.default();l.get("/",function(e,t){return t.sendFile(a)}),l.use(t.default.static("client/"+s));var c=new r.default.Server(l),f=+process.env.PORT||3e3,d=n.default.networkInterfaces();c.listen(f,function(){Object.values(d).forEach(function(e){e.forEach(function(e){e.internal||"IPv4"!=e.family||console.log("Listening on http://"+e.address+":"+f)})})});var v=u.default(c);v.on("connection",o.default(v));
},{"./socket/main":"W/tX"}]},{},["XAkt"], null)