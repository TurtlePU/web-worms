parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"c+uN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const{floor:e,pow:t,random:n}=Math;var r,o,l;function*u(e){let t=0,n=s([...new Array(e).keys()]);for(;t<n.length;)yield n[t++]}function s(t){for(let r=t.length-1;0!=r;--r){let o=e(n()*(r+1));[t[r],t[o]]=[t[o],t[r]]}return t}function f(t){let n="",r=o.length;for(let u=0;u!=l;++u)n+=`-${o[t%r]}`,t=e(t/r);return n.substr(1)}function i(e,n){l=n;const s=t((o=e).length,n);r=u(s)}function a(){let e=r.next();if(e.done)throw new RangeError("All IDs are used");return f(e.value)}exports.initIdGenerator=i,exports.default=a;
},{}],"VW3S":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("events");class e extends t.EventEmitter{constructor(t){super(),this.id=t,this.flush()}get socketList(){return[...this.sockets]}add(t){return this.sockets.push(t),t.join(this.id),this.socketInfo.set(t.id,this.SocketInfo(this.handlers(t))),this.connect(t),!0}cast(t,...e){return this.sockets.length&&this.sockets[0].server.to(this.id).emit(t,...e)}flush(){this.sockets=[],this.socketInfo=new Map}remove(t){let e=this.sockets.findIndex(e=>e.id==t.id);return-1!=e&&(this.sockets.splice(e,1),t.leave(this.id),this.disconnect(t),this.socketInfo.delete(t.id)),-1!=e}connect(t){for(let e of this.socketInfo.get(t.id).handlers){let{event:s,callback:o}=e;t.on(s,o)}}disconnect(t){for(let e of this.socketInfo.get(t.id).handlers){let{event:s,callback:o}=e;t.removeListener(s,o)}}disconnectAll(){for(let t of this.sockets)this.disconnect(t)}}exports.SocketRoom=e;
},{}],"4I7d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e,t){this.event=e,this.callback=t}}exports.Handler=e;
},{}],"6wCD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
},{}],"7LO/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("events");class t extends e.EventEmitter{constructor(e){super(),this.dummy=e,this.pool=new Map}add(e){return this.pool.set(e.id,e)}get(e){return this.pool.get(e)||this.dummy}}exports.Pool=t;
},{}],"Mh+j":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./class")),e(require("./handler")),e(require("./info")),e(require("./interface")),e(require("./pool"));
},{"./class":"VW3S","./handler":"4I7d","./info":"6wCD","./interface":"6wCD","./pool":"7LO/"}],"3MHI":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("./id-generator")),s=require("./room/export");class i extends s.Pool{constructor(){super({id:"lobby dummy",add:t=>!1,flush:()=>{},full:()=>!0,members:()=>[]}),this.vacants=new Set}add(t){return this.vacants.add(t.id),t.on("full",()=>{this.vacants.delete(t.id)}).on("start",()=>{this.vacants.delete(t.id),this.emit("start",t.id,t.socketList)}).on("vacant",()=>{this.vacants.add(t.id)}),super.add(t)}firstVacant(){return 0==this.vacants.size&&this.add(new a),this.pool.get(this.vacants.values().next().value)}flush(t){this.get(t).flush(),this.vacants.add(t)}}exports.default=new i;class a extends s.SocketRoom{constructor(){super(e.default())}add(t){return!this.full()&&(super.add(t),this.emitJoin(t),this.emitEnabled(),this.full()&&this.emit("full"),!0)}emitEnabled(){0!=this.sockets.length&&this.sockets[0].emit("lobby:start-enabled",this.ready())}emitJoin(t){this.cast("lobby:join",t.id,!1,t.id==this.sockets[0].id)}emitLeft(t){this.cast("lobby:left",t.id)}emitReady(t){this.cast("lobby:ready",t.id,this.socketInfo.get(t.id).ready,t.id==this.sockets[0].id)}full(){return this.sockets.length==a.CAPACITY}handlers(t){const e=()=>{this.remove(t),this.emitLeft(t),this.emitEnabled()};return[new s.Handler("lobby:left",e),new s.Handler("disconnect",e),new s.Handler("lobby:ready",e=>{this.socketInfo.get(t.id).ready=e,this.emitReady(t),this.emitEnabled()}),new s.Handler("lobby:start",t=>{if(!this.ready())return t(!1);t(!0),this.disconnectAll(),this.emit("start")})]}members(){return this.sockets.map((t,e)=>({id:t.id,ready:this.socketInfo.get(t.id).ready,first:0==e}))}ready(){return[...this.socketInfo.values()].every(t=>t.ready)}remove(t){return!!super.remove(t)&&(this.emit("vacant"),!0)}SocketInfo(t){return{ready:!1,handlers:t}}}a.CAPACITY=4;
},{"./id-generator":"c+uN","./room/export":"Mh+j"}],"3uE1":[function(require,module,exports) {
module.exports={crates:["heal","util","weapon"],dropChance:.5,gameTime:18e5,retreatTime:5e3,turnTime:3e4,wormCount:4};
},{}],"ZI85":[function(require,module,exports) {
module.exports={};
},{}],"xaTX":[function(require,module,exports) {
module.exports=["jjj","oof","heh","gg","kok","jej","wuw","wp","saas","sos","ooo","ded","liben","raigen","ponel","sasi","flask","dudon","baton","kuku","psina","smertb","borgar"];
},{}],"Ie+l":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const s=e(require("./schemes/game/basic.json"));exports.game={basic:s.default};const t=e(require("./schemes/physics/basic.json"));exports.physics={basic:t.default};const i=e(require("./id-digits.json"));exports.digits=i.default;
},{"./schemes/game/basic.json":"3uE1","./schemes/physics/basic.json":"ZI85","./id-digits.json":"xaTX"}],"zNUu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e){}dropCrate(){return null}makeTerrain(){return null}makeObjects(){return[]}placeWorms(e,r){return[]}}exports.default=e;
},{}],"xBAB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t,e){this.id=t,this.alive=!0,this.wormCount=e,this.index=0}nextWorm(){let t=this.index++;return this.index==this.wormCount&&(this.index=0),t}}exports.default=t;
},{}],"N61w":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,h){function n(e){try{o(s.next(e))}catch(t){h(t)}}function a(e){try{o(s.throw(e))}catch(t){h(t)}}function o(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(n,a)}o((s=s.apply(e,t||[])).next())})},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("events"),s=t(require("./physics")),r=t(require("./player")),{floor:h,random:n}=Math,a=1e4;class o extends i.EventEmitter{constructor(e,t){super(),this.physics=new s.default(e),this.scheme=t,this.suddenDeath=this.suddenDeath.bind(this),this.players=[],this.index=0}crateType(){let e=h(n()*this.scheme.crates.length);return this.scheme.crates[e]}dropCrates(){n()<=this.scheme.dropChance&&this.emit("crate",{type:this.crateType(),point:this.physics.dropCrate()})}increaseWaterLevel(){}isEnd(){return this.players.map(e=>+e.alive).reduce((e,t)=>e+t)<=1}nextPlayer(){let e=this.index++;return this.index==this.players.length&&(this.index=0),this.players[e]}suddenDeath(){}turn(){return e(this,void 0,void 0,function*(){let e=this.nextPlayer();this.death&&(this.suddenDeath(),yield this.ready()),this.dropCrates(),yield this.ready(),this.emit("turn",e.nextWorm()),yield this.wait(this.scheme.turnTime),yield this.wait(this.scheme.retreatTime),this.increaseWaterLevel()})}interrupt(e){e==this.players[this.index].id&&(clearTimeout(this.waitTimeout),this.resolve())}ready(){return e(this,void 0,void 0,function*(){return new Promise((e,t)=>{this.resolve=e,this.waitTimeout=setTimeout(t,a)})})}wait(t){return e(this,void 0,void 0,function*(){return new Promise((e,i)=>{this.resolve=e,this.waitTimeout=setTimeout(e,t)})})}addPlayer(e){let t=-1!=this.players.findIndex(t=>t.id==e);return t||this.players.push(new r.default(e,this.scheme.wormCount)),!t}removePlayer(e){let t=this.players.findIndex(t=>t.id==e);return-1!=t&&this.players.splice(t,1),-1!=t}start(){return e(this,void 0,void 0,function*(){this.emit("terrain",this.physics.makeTerrain()),this.emit("objects",this.physics.makeObjects());let e=this.physics.placeWorms(this.players.length,this.scheme.wormCount).map((e,t)=>({id:this.players[t].id,worms:e}));for(this.emit("worms",e),setTimeout(()=>this.death=!0,this.scheme.gameTime);!this.isEnd();)yield this.turn();this.emit("end")})}}exports.default=o;
},{"./physics":"zNUu","./player":"xBAB"}],"Nq6C":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("../data/export"),t=e(require("./game/class")),r=require("./room/export");class a extends r.Pool{constructor(){super({id:"room dummy",add:e=>!1,flush:()=>{},had:e=>!1,start:()=>{}})}add(e){return e.on("end",()=>{this.emit("end",e.id)}),super.add(e)}from(e,s){this.add(new d(e,s))}}exports.default=new a;class d extends r.SocketRoom{constructor(e,r){super(e),this.oldSockets=new Set,r.forEach(e=>this.add(e)),this.game=new t.default(s.physics.basic,s.game.basic)}ready(){return[...this.socketInfo.values()].every(e=>e.ready)}handlers(e){const t=()=>{this.remove(e),this.game.removePlayer(e.id)};return[new r.Handler("disconnect",t),new r.Handler("game:ready",()=>{this.socketInfo.get(e.id).ready=!0,this.ready()&&this.game.start()}),new r.Handler("room:left",t),new r.Handler("room:scheme:game",e=>{e(s.game.basic)}),new r.Handler("room:scheme:physics",e=>{e(s.physics.basic)})]}SocketInfo(e){return{handlers:e,ready:!1}}add(e){return!!this.oldSockets.has(e.id)||(this.oldSockets.add(e.id),super.add(e)&&this.game.addPlayer(e.id))}had(e){return this.oldSockets.has(e)}start(){this.cast("room:start",this.id)}}
},{"../data/export":"Ie+l","./game/class":"N61w","./room/export":"Mh+j"}],"wJlv":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("./lib/lobby")),o=e(require("./lib/room"));function l(e){console.log("+ socket"),e.on("lobby:get",e=>{e(t.default.firstVacant().id)}).on("lobby:check",(e,o)=>{o(!t.default.get(e).full())}).on("lobby:join",(o,l)=>{l(t.default.get(o).add(e))}).on("lobby:members",(e,o)=>{o(t.default.get(e).members())}),e.on("room:check",(e,t,l)=>{l(o.default.get(e).had(t))}).on("room:join",(t,l,d)=>{d(o.default.get(t).had(l)&&o.default.get(t).add(e))}),e.on("disconnect",()=>{console.log("- socket")})}t.default.on("start",(e,t)=>{o.default.from(e,t),o.default.get(e).start()}),o.default.on("end",e=>{t.default.flush(e)}),exports.default=l;
},{"./lib/lobby":"3MHI","./lib/room":"Nq6C"}],"XAkt":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("express")),r=e(require("http")),i=e(require("os")),n=e(require("path")),s=e(require("socket.io")),o=e(require("./socket")),a=require("./lib/id-generator"),u=require("./data/export");a.initIdGenerator(u.digits,3);const l=process.env.dev?"dist":"build",d=n.default.join(__dirname,`../client/${l}/index.html`),c=t.default();c.get("/",(e,t)=>t.sendFile(d)),c.use(t.default.static("client"));const f=new r.default.Server(c),p=parseInt(process.env.PORT)||3e3,q=i.default.networkInterfaces();f.listen(p,()=>{Object.values(q).forEach(e=>{e.forEach(e=>{e.internal||"IPv4"!=e.family||console.log(`Listening on ${e.address}:${p}`)})})});const v=s.default(f);v.on("connection",o.default);
},{"./socket":"wJlv","./lib/id-generator":"c+uN","./data/export":"Ie+l"}]},{},["XAkt"], null)